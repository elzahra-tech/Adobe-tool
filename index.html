<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI-Powered Metadata Tool</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #preview img { max-width: 150px; margin: 10px; }
    .result { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
  </style>
</head>
<body>
  <h1>Upload Images for Metadata Generation</h1>
  <input type="file" id="imageUpload" multiple accept="image/png,image/jpeg" />
  <button id="generateBtn">Generate Metadata</button>
  <div id="preview"></div>
  <div id="results"></div>  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.3.0';

    let captionGenerator;
    let images = [];

    document.getElementById('imageUpload').addEventListener('change', async (event) => {
      images = Array.from(event.target.files);
      const preview = document.getElementById('preview');
      preview.innerHTML = '';
      images.forEach((file) => {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      });
    });

    document.getElementById('generateBtn').addEventListener('click', async () => {
      if (!images.length) {
        alert('Please upload at least one image.');
        return;
      }

      const resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = 'Loading model...';

      try {
        if (!captionGenerator) {
          captionGenerator = await pipeline('image-to-text', 'Xenova/blip-image-captioning-base');
        }
      } catch (error) {
        resultsContainer.innerHTML = 'Failed to load model. Please refresh or try later.';
        return;
      }

      resultsContainer.innerHTML = '';

      for (const file of images) {
        const arrayBuffer = await file.arrayBuffer();
        const caption = await captionGenerator(arrayBuffer);

        const resultDiv = document.createElement('div');
        resultDiv.className = 'result';
        resultDiv.innerHTML = `<strong>File:</strong> ${file.name}<br>
                               <strong>Title:</strong> ${caption[0].generated_text}<br>
                               <strong>Keywords:</strong> ${generateKeywords(caption[0].generated_text)}`;
        resultsContainer.appendChild(resultDiv);
      }
    });

    function generateKeywords(text) {
      const words = text.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
      const unique = [...new Set(words)];
      const keywords = unique.slice(0, 50);
      return keywords.join(', ');
    }
  </script></body>
</html>
